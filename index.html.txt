<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Advisor Pro</title>
    <style>
        :root { --bg: #131314; --card: #1e1f20; --text: #e3e3e3; --accent: #8ab4f8; --input-bg: #28292a; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        #sidebar { width: 260px; background: #000; padding: 20px; display: flex; flex-direction: column; gap: 15px; border-right: 1px solid #333; }
        .tier-card { background: #1a1a1a; padding: 15px; border-radius: 12px; border: 1px solid #333; font-size: 14px; }
        .limit-box { margin-top: auto; padding: 10px; background: #28292a; border-radius: 8px; font-size: 12px; text-align: center; }
        .progress-bar { height: 8px; background: #444; border-radius: 4px; margin-top: 8px; overflow: hidden; }
        #progress-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s; }

        /* Main Chat Area */
        #main { flex: 1; display: flex; flex-direction: column; align-items: center; }
        #app { display: none; flex-direction: column; width: 100%; max-width: 700px; height: 100%; padding: 20px; box-sizing: border-box; }
        #messages { flex: 1; overflow-y: auto; padding: 20px 0; display: flex; flex-direction: column; gap: 20px; }
        .msg { line-height: 1.6; max-width: 85%; padding: 12px 18px; border-radius: 18px; }
        .user-msg { align-self: flex-end; background: var(--input-bg); }
        .bot-msg { align-self: flex-start; border-left: 2px solid #444; }
        
        /* Input */
        .input-container { display: flex; gap: 10px; background: var(--input-bg); padding: 10px; border-radius: 25px; margin-bottom: 20px; }
        input { flex: 1; background: transparent; border: none; color: white; padding: 10px; outline: none; }
        .icon-btn { background: none; border: none; cursor: pointer; color: var(--accent); font-size: 18px; }
        
        /* Overlay for blocked users */
        #paywall { display: none; position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 200; align-items: center; justify-content: center; text-align: center; padding: 20px; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h3>Family Advisor</h3>
        <div class="tier-card" style="border-color: gold;">
            <strong>Pro Version</strong>
            <p style="color:#888; font-size: 12px;">Unlock unlimited voice and deeper expert insights.</p>
            <button onclick="alert('Payment system coming soon!')" style="width:100%; background:gold; border:none; padding:8px; border-radius:5px; cursor:pointer;">Upgrade Now</button>
        </div>
        
        <div class="limit-box">
            <span id="limit-text">Questions today: 0 / 10</span>
            <div class="progress-bar"><div id="progress-fill"></div></div>
        </div>
    </div>

    <div id="main">
        <div id="paywall">
            <div style="background:var(--card); padding:40px; border-radius:24px; max-width:400px;">
                <h2>Daily Limit Reached</h2>
                <p>You have used your 10 free questions for today. Come back tomorrow or upgrade to Pro for unlimited access.</p>
                <button onclick="alert('Payment setup needed')" style="background:var(--accent); border:none; padding:12px 24px; border-radius:20px; cursor:pointer; font-weight:bold;">Upgrade to Pro</button>
            </div>
        </div>

        <div id="app" style="display: flex;">
            <div id="messages">
                <div class="bot-msg msg">Welcome back. How can I help your family today?</div>
            </div>
            <div class="input-container">
                <button class="icon-btn" onclick="startVoice()">ðŸŽ¤</button>
                <input type="text" id="userInput" placeholder="Ask a question...">
                <button class="icon-btn" onclick="send()">âž”</button>
            </div>
        </div>
    </div>

    <script>
        const DAILY_LIMIT = 10;

        function getUsage() {
            const today = new Date().toLocaleDateString();
            const data = JSON.parse(localStorage.getItem('usage_stats') || '{}');
            if (data.date !== today) {
                return { date: today, count: 0 };
            }
            return data;
        }

        function updateUI() {
            const usage = getUsage();
            document.getElementById('limit-text').innerText = `Questions today: ${usage.count} / ${DAILY_LIMIT}`;
            document.getElementById('progress-fill').style.width = (usage.count / DAILY_LIMIT * 100) + '%';
            
            if (usage.count >= DAILY_LIMIT) {
                document.getElementById('paywall').style.display = 'flex';
            }
        }

        async function send() {
            const usage = getUsage();
            if (usage.count >= DAILY_LIMIT) return;

            const input = document.getElementById('userInput');
            const msgDiv = document.getElementById('messages');
            if (!input.value) return;

            const prompt = input.value;
            msgDiv.innerHTML += `<div class="user-msg msg">${prompt}</div>`;
            input.value = '';

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: prompt })
                });
                const data = await response.json();
                
                msgDiv.innerHTML += `<div class="bot-msg msg">${data.text}</div>`;
                
                // Increment Usage
                usage.count++;
                localStorage.setItem('usage_stats', JSON.stringify(usage));
                updateUI();
                
                msgDiv.scrollTop = msgDiv.scrollHeight;
            } catch (e) {
                msgDiv.innerHTML += `<div class="bot-msg msg">Error connecting.</div>`;
            }
        }

        function startVoice() {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.onresult = (e) => { document.getElementById('userInput').value = e.results[0][0].transcript; };
            recognition.start();
        }

        window.onload = updateUI;
    </script>
</body>
</html>
        }
    </script>
</body>

</html>
